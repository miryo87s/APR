---
format: 
  revealjs:
    theme: ["theme/q-theme.scss"]
    slide-number: c/t
    logo: "unsw-long.png"
    footer: "PhD Seminar"
    code-copy: true
    center-title-slide: false
    include-in-header: heading-meta.html
    code-link: true
    code-overflow: wrap
    highlight-style: a11y
    height: 1080
    width: 1920
    chalkboard: true
    fontsize: 28pt
    linestretch: 1.7
    auto-stretch: false
    html-math-method: mathjax
callout-appearance: simple
callout-icon: false
bibliography: ref.bib
editor: 
  markdown: 
    wrap: 72
---

```{r}
#| echo: false
#| include: false
#| warning: false

librarian::shelf(ggplot2, quiet = T)
```

<h1>Causal Interpretation of Least Square Estimand under Model- and Design-Based Specification</h1>

<br>

<h2>PhD Seminar</h2>

<hr>

<h3>Fangzhou Yu</h3>

<h3>2024-08-14</h3>

<br>

![](unsw.png){.absolute top="550" left="1400" width="400"}

## The Literature and Motivation

<br>

- A recent literature has raised concern on OLS/IV estimation of treatment effects
  - Fail to identify a convex average of treatment effects
  - Negative weights can lead to sign reversal <span style="font-size: 70%"> [@small2017instrumental] <span>
- Negative weights have been observed in various research designs
  - TWFE specification of staggered DiD <br>
  <span style="font-size: 70%"> [@de2020two; @goodman2021difference; @sun2021estimating; @borusyak2022revisiting] <span>
  - OLS with multiple treatments <br> 
  <span style="font-size: 70%"> [@goldsmith2022contamination] <span>
  - IV regression with covariates <br>
  <span style="font-size: 70%"> [@small2017instrumental; @blandhol2022tsls] <span>
  
## The Literature and Motivation

<br>

- Negative weights can arise even in the most basic OLS specification
$$
Y_i = \tau_{ols} D_i + X_i \beta + \epsilon_i
$$ {#eq-ols}
for outcome $Y_i$, single treatment $D_i$, and covariates $X_i$.
- @borusyak2024negative show that $\tau$ identifies weighted average of treatment effects
  - Negative weights generally exist if the specification is [model-based]{.blue}, <br>
  i.e. @eq-ols leverages a correct model of potential outcomes
  - No concern if the specification is [design-based]{.blue}, <br>
  i.e. @eq-ols leverages a correct model of treatment

## This Paper

<br>

I show that negative weights are not **necessarily a concern** when specification is model-based

<br>

- For design-based specification, the weight is guaranteed to be convex
- For model-based specification, when treatment is **binary**
  - $\tau_{ols}$ identifies **weighted ATT**
  - There is potential threat of negative weight
  - But this is due to the fact that treatment can only take $0$ or $1$ and specification is linear
  - The threat only exists for treated units
  - There are commonly used specifications that do not suffer from negative weight

## This Paper

<br>

I extend to the general case: partially linear regression (PLR) with continuous treatment 

<br>

- Incorporate binary treatment and OLS as special cases
- Either specification yields convex weighted average effects
  - Continuous treatment identifies **weighted average derivative effects (WADE)**
  - Weights depend on the marginal distribution of treatment
- The weights of PLR is optimally efficient in the class of WADE when outcome is homoskedastic
  - Under standard design-based assumption
  - Encourage the use of PLR/OLS for estimating causal effect
  
## More Connection to Literature: Binary Treatment

<br>

[The weighting scheme of OLS/IV with a single treatment/instrument]{.blue} <br> 
<span style="font-size: 70%"> e.g. @angrist1998estimating; @aronow2016does; @sloczynski2022interpreting; @borusyak2024negative; @imbens1994identification; @angrist1996identification; @small2017instrumental <span>

- Similar model- and design-based analysis as @borusyak2024negative
- Causal interpretation of OLS estimand based on weaker assumptions
- Extension to IV(LATE) using a weak monotonicity assumptions introduced by @small2017instrumental

[Overlap-weighted Inverse Propensity Weighting (IPW)]{.blue} <br> 
<span style="font-size: 70%"> @crump2006moving; @li2018balancing <span>

- Design-based OLS is shown to be equivalent to overlap-weighted IPW

## More Connection to Literature: Continuous Treatment

[Identification of continuous treatment]{.blue} <br>
<span style="font-size: 70%"> @rothenhausler2019incremental; @callaway2024difference; @borusyak2024negative <span>

- I show continuous treatment generally identifies derivative effects introduced by @rothenhausler2019incremental

[Nonparametric Index Model]{.blue} <br>
<span style="font-size: 70%"> e.g. @robinson1988root; @powell1989semiparametric; @hardle1989investigating <span>

- First to connect PLR/Index Model to causal inference
- Identification based on Riesz Representation theorem

[Efficient WADE]{.blue} <br>

- The efficiency result extends the efficiency bound for binary treatment established by @crump2006moving and @li2018balancing

[Estimation of PLR]{.blue} <br>
<span style="font-size: 70%"> @robins1994estimation; @chernozhukov2018double <span>

## OLS with Binary Treatment

<br>

- Potential outcomes: $Y_i(1)$ and $Y_i(0)$
- Observed outcome: $Y_i = D_iY_i(1) + (1 - D_i)Y_i(0)$
- Rearrange to get
$$
Y_i = (Y_i(1) - Y_i(0))D_i + Y_i(0) = \tau_i D_i + Y_i(0)
$$
where $\tau_i = Y_i(1) - Y_i(0)$ is the individual treatment effect
- Consider OLS estimation of
$$
Y_i = \tau_{ols} D_i + X_i \beta + \epsilon_i
$$

Let $\tilde{D}_i$ be the residual of the population projection of $D_i$ on $X_i$. By Frish-Waugh-Lovell theorem, 
$$
\tau_{ols} = \frac{\mathbb{E}[\tilde{D}_iY_i]}{\mathbb{E}[\tilde{D}_iD_i]} = \frac{\mathbb{E}[\tau_i\tilde{D}_iD_i] + \mathbb{E}[\tilde{D}_iY_i(0)]}{\mathbb{E}[\tilde{D}_iD_i]}. 
$$ {#eq-tau}

## OLS with Binary Treatment 

<br>

Model-based specification: 

$$
\mathbb{E}[Y_i(0)|D_i, X_i] = X_i\eta.
$$ {#eq-model}

**Example:** parallel trend assumptions. $X_i$ includes time and unit dummies with $i$ indexing a pair of time and unit.

<br>

Design-based specification:

$$
\mathbb{E}[D_i|Y_i(0), Y_i(1), X_i] = X_i\gamma.
$$ {#eq-design}

**Example:** $D_i$ is the eligibility for a program which is determined by some features $X_i$. $\tau_i$ is intention-to-treat effect.

<br>

- Both can be seen as a combination of **conditional mean-independence and linearity**
- Both are weaker than what is usually assumed in empirical research

## OLS Model-Based Weight

<br>

- Under either specification, $\mathbb{E}[\tilde{D}_iY_i(0)] = 0$ by mean-independence

<br>

- Under model-based specification, 
$$
\tau_{ols} = \frac{\mathbb{E}[\lambda_i\tau_i]}{\mathbb{E}[\lambda_i]}, \quad \lambda_i = \tilde{D}_i D_i
$$
- $\lambda_i = 0$ when $D_i = 0$, so $\tau_{ols}$ is **weighted ATT**
- $\lambda_i = 0$ cannot preclude negative values
  - Negative when $D_i = 1$ and $\tilde{D}_i < 0$, i.e. the projection of $D_i$ on $X_i$ exceeds unit value
- But @borusyak2024negative overstated the concern
  - "... (model-based) weighting scheme is not convex. This is because $\tilde{D}_i$ necessarily takes on both positive and negative values, since $\mathbb{E}[\tilde{D}_i] = 0$"

## OLS Design-Based Weight

<br>

- Under design-based specification 
- By the law of total expectation,

$$
\mathbb{E}[\tau_i\tilde{D}_iD_i] = \mathbb{E}[\mathbb{E}[\tilde{D}_iD_i|Y_i(0), Y_i(1), X_i]\tau_i]
$$

- Therefore, we have

$$
\tau_{ols} = \frac{\mathbb{E}[\omega_i\tau_i]}{\mathbb{E}[\omega_i]}, \quad \omega_i = Var(D_i | Y_i(0), Y_i(1), X_i)
$$

- $\omega_i$ is guaranteed to be convex because $Var(D_i | Y_i(0), Y_i(1), X_i) \geqslant 0$

## Special Model-Based Assumptions

Special cases where model-based assumptions can guarantee convex weights

<br>

[Special Case 1: Saturated $X_i$]{.blue}

- This case was studied in @angrist1998estimating
- A common example of saturated $X_i$ is One-Way Fixed Effect

$$
Y_i = \beta_s + \tau_{owfe} D_i + \epsilon_i
$$

- Let $n_{1s} = \sum_{i \in s}D_i$, $n_{0s} = \sum_{i \in s}1 - D_i$
- Let $\bar{Y}_{ds}$ be the sample mean of $Y_i$ in the treatment and control group for $d = 1, 0$ in stratum $s$

$$
\tau_{owfe} = \frac{\mathbb{E}[\lambda_{owfe, s}\tau_s]}{\mathbb{E}[\lambda_{owfe, s}]}, \quad \lambda_s = \frac{n_{1s}n_{0s}}{n_{1s} + n_{0s}}, \ \tau_s = \bar{Y}_{1s} - \bar{Y}_{0s}
$$

## Special Model-Based Assumptions

<br>

[Special Case 2: Full Interaction Regression]{.blue}

- Consider an extra assumption $\mathbb{E}[\tau_i | D_i, X_i] = X_i\xi$ and the flexible specification

$$
Y_i = \tau_{ob}D_i + (X_i - \bar{X})\beta + D_i(X_i - \bar{X})\xi + \epsilon_i
$$

- $\tau_{ob}$ identifies the ATE
- This method is equivalent to regressing $Y_i$ on $X_i$ using treatment group and control group separately
- Also equivalent to Oaxaca-Blinder method [@oaxaca1973male; @blinder1973wage]
- @kline2011oaxaca showed $\tau_{ob}$ is equivalent to IPW with a linear model for the conditional odds of being treated

## Special Model-Based Assumptions

<br>

[Special Case 3: Canonical DiD]{.blue}

- Canonical DiD refers to the TWFE model of $2 \times 2$ DiD

$$
Y_{it} = \beta_i + \gamma_t + \tau_{twfe} D_{it} + \epsilon_{it}
$$

- Parallel trend assumption: $Y_{it}(0)$ is a linear function of $\beta_i$ and $\gamma_t$
- Assume balanced panel data and proportion of treatment group is $p$

$$
\tilde{D}_{it} = D_{it} - \bar{D}_i - \bar{D}_t + \bar{D}
$$

- $\bar{D}_i$ is mean over time, $\bar{D}_t$ is mean over group, and $\bar{D}$ is total mean

## Special Model-Based Assumptions

<br>

[Special Case 3: Canonical DiD cont'd]{.blue}

![](fig/tbl1.png){fig-align="center" width=40%}

- $\tilde{D}_i$ is negative for treated in pre-period, or control in post-period
- $D_{it} = 1$ for treated in post-period
- $\lambda_{it} = (1-p)/2$ for all treated in post-period and $0$ otherwise. Therefore, $\tau_{twfe}$ is ATT


## Stronger Design-Based Assumption

Stronger design-based assumption is not necessary for convex weights, but can connect between OLS and IPW

<br>

::: {.callout-warning}

## Assumption 1 (Linear Propensity)

$$
e(x) = \mathbb{E}[D_i | X_i = x] = X_i\delta
$$ 
where $e(x)$ is the propensity score of treatment.

:::

::: {.callout-warning}

## Assumption 2 (Unconfoundedness and Overlap)

1. Unconfoundedness: $D_i \perp (Y_i(0), Y_i(1)) | X_i$ . 
2. Overlap: $\exists \ \xi > 0, \ \text{s.t.} \ \xi \leqslant e(x) \leqslant 1 - \xi$ .

:::

## Stronger Design-Based Assumption

::: {.panel-tabset}

### Proposition

::: {.callout-note #prp-wipw}

## Proposition 1 (Equivalence of OLS Estimand and Overlap Weighted IPW)

Under Assumption 1
$$
\tau_{ols} = \tau_{overlap}
$$
where $\tau_{overlap}$ is the estimand of overlap-weighted IPW
$$
\tau_{overlap} = \mathbb{E}\left[\frac{e(X_i)(1 - e(X_i))}{\mathbb{E}[e(X_i)(1 - e(X_i))]} \cdot \left(\frac{Y_iD_i}{e(X_i)} - \frac{Y_i(1 - D_i)}{1 - e(X_i)}\right)\right] .
$$ 

Assumption 2 further yields the identification of overlap-weighted ATE (@li2018balancing):
$$
\tau_{ols} = \mathbb{E}\left[\frac{e(X_i)(1 - e(X_i))}{\mathbb{E}[e(X_i)(1 - e(X_i))]} \cdot \tau_i\right] .
$$

:::

### Proof

By the projection or the Frisch-Waugh-Lovell theorem, we have 
$$
\tau_{ols} = \frac{\mathbb{E}[Y_i\tilde{D}_i]}{\mathbb{E}[\tilde{D}_i^2]}
$$
where $\tilde{D}_i = D_i - X_i\beta_e$ with $\beta_e = \mathbb{E}[X'X]^{-1}\mathbb{E}[X'D]$. Then we have
$$\begin{aligned}
\tau_{ols} &= \frac{\mathbb{E}[Y_i(D_i - e(X_i))]}{\mathbb{E}[(D_i - e(X_i))^2]} \\
&= \frac{\mathbb{E}[Y_i(D_i - e(X_i))]}{\mathbb{E}[e(X_i)(1 - e(X_i))]} \\
&= \mathbb{E}\left[\frac{e(X_i)(1 - e(X_i))}{\mathbb{E}[e(X_i)(1 - e(X_i))]} \frac{Y_i(D_i - e(X_i))}{e(X_i)(1 - e(X_i))}\right]  = \tau_{overlap}
\end{aligned}$$

Identification of $\tau_{overlap}$ under Assumption 2 follows standard proof of IPW.

:::

## Extension to IV

<br>

Further follow @small2017instrumental, assume

::: {.callout-warning}

## Assumption 3 (Stochastic First-Stage Monotonicity)

$$
Pr(D_i = 1 | Y_i(0), Y_i(1), Z_i = 1, X_i = x) \geqslant Pr(D_i = 1 | Y_i(0), Y_i(1), Z_i = 0, X_i = x) \ \text{for all} \ x. 
$$

:::

Model-based specification: $\mathbb{E}[Y_i(0)|Z_i, X_i] = X_i\eta$

$$
\tau_{iv} = \frac{\mathbb{E}[\lambda_i\tau_i]}{\mathbb{E}[\lambda_i]}, \quad \text{where} \ \lambda_i = \tilde{Z_i}D_i. 
$$

Design-based specification: $\mathbb{E}[Z_i|Y_i(0), Y_i(1), X_i] = X_i\gamma$

$$
\tau_{iv} = \frac{\mathbb{E}[\omega_i\tau_i]}{\mathbb{E}[\omega_i]}, \quad \text{where} \ \omega_i = Cov(\tilde{Z}_i, Pr(D_i = 1 | Y_i(0), Y_i(1), Z_i, X_i)). 
$$

## Summary of OLS with Binary Treatment

<br>

Design-based specification:

- Ensures convex weight
- Equivalent to overlap-weighted IPW under stronger assumptions

Model-based specification:

- Carries a potential risk of negative weights
- Due to the projection of $D_i$ on $X_i$ exceeding unit value
- There are special cases where negative weights are no concern

<br>

Next, extend to partially linear regression with continuous treatment

## Causal Effect of Continuous Treatment

<br>

The causal effect of continuous treatment is still an active research topic

@callaway2024difference & @borusyak2024negative: 

- Restrict treatment value $D_i \neq 0$ 
- Define causal effect as average causal derivative $\partial\mathbb{E}[Y_i(d)]/\partial d$ or the direct derivative $\partial Y_i(d)/ \partial d$
- Limited discussion on general identification

<br>

I follow @rothenhausler2019incremental:

- First define incremental effect: 

$$
\tau^\nu = \frac{\mathbb{E}[Y_i(d + \nu)] - \mathbb{E}[Y_i(d)]}{\nu}
$$

- Define the **average derivative effect** $\tau^0 = \lim_{\nu \rightarrow 0} \tau^\nu$








## References {visibility="uncounted"}



